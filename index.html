<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="user-scalable=no,width=device-width,initial-scale=1">
	<meta name="theme-color" content="#404040">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<title>Canon Daily</title>
	<link rel="manifest" href="./manifest.json">
	<link rel="shortcut icon" href="./icons/bible.ico">
	<style type="text/css">
		html, body {
			margin: 0;
			padding: 0;
		}
		body {
			font-family: calibri, arial, sans-serif;
			font-size: 15pt;
			background-color: #fafafa;
			line-height: 1.6;
			font-weight: 300;
		}
		hr {
			border: none;
			border-top: 1px solid #ccc;
		}

		nav {
			background-color: #404040;
			color: #fff;
			font-weight: bold;
			overflow: hidden;
		}
		nav a,
		nav a:visited {
			color: #fff;
			text-decoration: none;
			padding: 4pt;
		}
		nav a:hover {
			background-color: #555;
		}
		.nav-title {
			font-size: 30pt;
		}
		.nav-input {
			border: none;
			background-color: #fff;
			font-size: 12pt;
			margin: 4pt 0;
		}
		.flex-left {
			display: flex;
			justify-content: space-between;
			align-items: center;
			flex-wrap: wrap;
		}
		.dark-bg {
			background-color: #ccc;
		}

		.section,
		.container {
			margin: 0 auto;
			max-width: 32em;
			padding: 0 0.5em;
		}
		.section {
			margin-top: 1em;
			margin-bottom: 2em;
		}
		#background-message,
		.header {
			font-size: 2em;
			display: block;
			text-align: center;
		}

		#background-message {
			margin-top: 40vh;
		}

		.chapter, .verse {
			display: none;
		}

		.paragraph,
		.stanza {
			display: block;
			margin: 1em 0;
		}
		.stanza .line {
			display: block;
		}

		.subsection .header {
			font-size: 1.6em;
		}
		.subheader {
			font-size: 1.4em;
			display: inline;
			padding-right: 1em;
		}
	</style>
	<script type="text/javascript">
	var _paq = _paq || [];
	_paq.push(['trackPageView']);
	_paq.push(['enableLinkTracking']);
	(function() {
		var u="https://jlddata.com/";
		_paq.push(['setTrackerUrl', u+'p.php']);
		_paq.push(['setSiteId', '1']);
		var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'p.js'; s.parentNode.insertBefore(g,s);
	})();
	</script>
</head>
<body>
	<noscript>This page requires javascript. Sorry!</noscript>
	<nav>
		<div class="container flex-left">
			<a class="nav-title" href="./">Canon Daily</a>
			<form>
				<input class="nav-input" id="date" type="date" name="date" onchange="this.form.submit()">
			</form>
			<a href="./?page=prayer-for-filling-of-spirit">Prayer</a>
			<a href="https://github.com/ArtskydJ/canondaily.com">Github</a>
		</div>
	</nav>

	<div id="content">
		<span id="background-message">Loading...</span>
	</div>

	<script>
		var dateInput = document.getElementById('date')
		var day = new Date()
		var today = ''
		var page = ''

		var qsDate = /[?&]date=(\d{4}-\d\d-\d\d)/.exec(location.search)
		if (qsDate) {
			day = new Date(qsDate[1])
			dateInput.value = qsDate[1]
			today = pad(day.getUTCMonth() + 1) + '/' + pad(day.getUTCDate())
		} else {
			dateInput.value = getLocalISODateString(day)
			today = pad(day.getMonth() + 1) + '/' + pad(day.getDate())
		}

		page = 'passages/' + today
		today = ' - ' + today

		var qsOther = /[?&]page=([\w-]+)/.exec(location.search)
		if (qsOther) { // This feels like a hack :(
			page = 'other-pages/' + qsOther[1]
			today = ''
		}

		document.title = 'Canon Daily' + today

		xhr('./' + page + '.html', function (err, result) {
			var contentHtml = ''
			if (err) {
				document.getElementById('background-message').innerHTML = err.message
			} else if (!result.ok) {
				document.getElementById('background-message').innerHTML = result.status + ' ' + result.statusText
			} else {
				document.getElementById('content').innerHTML = result.text
			}
		})


		function getLocalISODateString(date) {
			var year = date.getFullYear()
			var month = pad(date.getMonth() + 1)
			var day = pad(date.getDate())
			return year + '-' + month + '-' + day
		}

		function pad(num) {
			return ('0' + num).slice(-2)
		}

		function xhr(url, cb) {
			var req = new XMLHttpRequest()
			req.open('GET', url, true)
			req.onerror = cb
			req.onload = function onload() {
				cb(null, {
					ok: (req.status >= 200 && req.status < 300),
					status: req.status,
					statusText: req.statusText,
					url: req.responseURL,
					text: req.responseText
				})
			}

			req.send()
		}
	</script>
</body>
</html>
